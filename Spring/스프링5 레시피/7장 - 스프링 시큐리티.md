# 7장 - 스프링 시큐리티

## 도입 - 보안 관련 용어정리

### 인증

주체(사용자, 시스템, 기기)가 자기자신임을 **증명**하는 과정

일반적으로 주체가 크레덴셜을 제시합니다.

<br>

### 인가

인증을 마친 주체에게 특정 리소스에 접근할 수 있게 **허가**하는 과정

인증 과정 이후 수행되며, 권한은 롤 형태로 부여됩니다.

<br>

### 접근 통제

리소스에 접근하는 행위를 제어하는 일

**접근 통제 결정**이 뒤따릅니다.

리소스의 접근 속성과 유저에게 부여된 권한 또는 다른 속성들을 견주어 결정합니다.

<br>

## URL 접근 보안

### AbstractSecurityWebApplicationInitializer

이 클래스를 상속하면 필터 등록 및 구성 내용을 자동감지할 수 있게 됩니다.

:question: 상속받는 주체는 누구인가?

:a: AbstractSecurityWebApplicationInitializer 생성자는 **하나 이상의 구성 클래스를 인수**로 받아 보안기능을 동작시킵니다.

```java
public class TodoSecurityInitializer extends AbstractSecurityWebApplicationInitializer {
	public TodoSecurityInitializer() {
		super(TodoSecurityConfig.class);
	}
}
```

여기서, TodoSecurityConfig 클래스는 구성클래스입니다.

<br>

### WebSecurityConfigurerAdapter

웹 애플리케이션 보안을 구성할 수 있도록 한 **구성 어댑터**

<br>

```java
@Configuration
@EnableWebSecurity
public class TodoSecurityConfig extends WebSecurityConfigurerAdapter {
    
}
```

<br>

위와 같이 설정 후, 배포하면 스프링 시큐리티 기본 제공 로그인 페이지가 나타납니다.

<br>

### URL 접근 보안하기

#### WebSecurityConfigurerAdapter 클래스의 configure(HttpSecurity http) 메서드

```java
protected void configure(HttpSecurity http) throws Exception {
	http.authorizeRequests()
		.anyRequest().authenticated()
		.and()
		.formLogin()
		.and()
		.httpBasic();
}
```

위의 코드는 3가지 기능을 수행합니다.

1. 어떤 요청이든 인증을 받도록 강제합니다.
2. 폼 기반 로그인 기능을 켭니다.
3. HTTP 기본인증(Basic Authorization) 기능을 켭니다.

<br>

위 같은 설정 외에도 **교재 388쪽** 과 같이 설정가능합니다.

<br>

#### WebSecurityConfigurerAdapter 클래스의 configure(AuthenticationManagerBuilder auth) 메서드

스프링 시큐리티에서는 위의 메소드를 오버라이드하여, DB 또는 LDAP 저장소를 조회 후, 주체를 인증하는 몇가지 방법을 지원합니다.

<br>

### CSRF 공격방어

구성 클래스에서는 기본 값으로 CSRF 공격을 방어하도록 설정되어 있습니다. 만약, 이 기능을 해제하고 싶다면, http 설정에 `csrf().disable()` 을 추가하면 됩니다.

CSRF 방어 기능이 작동하는 상태에서 **CsrfRepository 인터페이스의 구현체**를 이용하면, **토큰 값을 생성/보관하는 기능을 수행하는 CsrfFilter**를 추가할 수 있습니다.

<br>

#### HttpSessionCsrfRepository 클래스

이름 그대로 생성한 토큰을 HttpSession에 저장하는 기능을 수행하는 CsrfRepository 구현체입니다.

<br>

#### CookieCsrfRepository 클래스

이름 그대로 생성한 토큰을 쿠키에 저장하는 기능을 수행하는 CsrfRepository 구현체입니다.

<br>

#### 구성클래스에서 csrfTokenRepository() 메소드

이 메소드를 이용하면, 생성한 CsrfRepository 구현체를 구성 클래스에서 사용하도록 정할 수 있습니다.

<br>

